# Machine-Learning-Based Blind Source Separation
- 4-th year's Final Project, for the partial fulfillment of the requirements for a B.Sc. Degree.

- Bar-Ilan University, the Faculty of Engineering, Project No. 507 (of year 2024).

## About this Repository

This code is a modification of the RF Challenge [starter code](https://github.com/RFChallenge/icassp2024rfchallenge), where it was updated with quality of life changes, and modified for simulations of training and testing signal mixture source separation via DNNs with interference uncertainty. The interference mixture is referred as the interference probability mixture (IPM), and the code supports K=2 types of interference.

## RF Challenge Dataset
For generating datasets of signal mixtures, the project used the [RF Challenge Interference Dataset](https://www.dropbox.com/scl/fi/zlvgxlhp8het8j8swchgg/dataset.zip?rlkey=4rrm2eyvjgi155ceg8gxb5fc4&dl=0).

## Weights
QPSK CT-DNN weights for the UNet and WaveNet can be obtained here: [reference_models.zip](https://www.dropbox.com/scl/fi/890vztq67krephwyr0whb/reference_models.zip?rlkey=6yct3w8rx183f0l3ok2my6rej&dl=0)
(`/models` folder for UNet model, `/torchmodels` for WaveNet Model)

8/16PSK CT-UNet weights, along with all MT-UNet and 8L-MT-UNet weights can be obtained [here](https://www.dropbox.com/scl/fi/gzriho4wv8zeodrswcejm/unet_models.zip?rlkey=qhejjcme6m88roktmgvlfkdyf&st=qhv4vs4t&dl=0)).

Extra weights of models that were also trained in the project can be obtained [here](https://www.dropbox.com/scl/fi/ijg3v1xfgxy7eu3vodf59/extra_models.zip?rlkey=glpxauktf53mpzy6bqr2smeck&st=n0nl2qne&dl=0).

#### File Descriptions:

- For a complete overview of the dependencies within of the UNet's Anaconda environment, please refer [here (tf_env)](https://github.com/amirweiss15/ICC2026_dts_vs_ujm/blob/main/tf_env.yml).
- For a complete overview of the dependencies within of the WaveNet's Anaconda environment, please refer [here (pytorch_env)](https://github.com/El-rod/ML-Based-Blind-Source-Seperation/blob/main/pytorch_env.yml). 

## Files for training:

(1). `generate_training_dataset.py`: python script that creates D sample mixtures with varying random target SINR levels (ranging between -33 dB and 3 dB). For each signal mixture configuration, the output is saved as D/n HDF5 files, each containing n mixtures. For the paper we used the default RF Challenge setup of D=240000 and n=4000, making 60 HDF5 files for each mixture dataset.

(2). `example_tfds_preprocess_mixture_dataset.py`: preprocesses the training dataset created in (1) into a supervised-learning TensorFlow dataset. In the terminal use the command `tfds build dataset_utils/example_tfds_preprocess_mixture_dataset.py --data_dir tfds/` in order to run it.
Used in conjunction with the Tensorflow UNet training scripts;
the HDF5 files are processed into Tensorflow Datasets (TFDS) for training.


(3). `train_unet_model.py`: trains the Tensorflow UNet architecture (see `src/unet_model.py` and `unet_8layered_model.py`) on the tfds dataset created in (2).

## Files for testing
(1). `generate_mixture_with_uncertainty_testset.py`: generates a testset of a signal mixture with an interference mixture of P(b1)=p, of 11 discrete target SINR levels. Saves a pickle file `Dataset_Seed[seed]_[soi_type]+[interference_type1]âˆ¨[interference_type2].pkl` that contains `all_sig_mixture, all_sig1_groundtruth, all_bits1_groundtruth, meta_data`, sorted by SINR levels.

(2). `generate_mixture_single_interference_testset.py`: same as (1) but for p=1 only, i.e., saves it as `Dataset_Seed[seed_number]_[soi_type]+[interference_sig_type].pkl`.

(3). `evaltest_unet_interference_uncertainty.py`: processes the testset created in (1) on the desired UNet model (DTS, 5L-UJM, UJM), both waveform prediction and BER calculation. Saves results in the `/outputs` folder.

(4). `evaltest_unet_single_interference.py`: same as (3) but for the testset created in (2). Here interfrence type 2 (p=0) is decided by which 5L-UJM/UJM is chosen.

## Utility files
(1). The SOI is generated by the files in the `/rfutils` folder.
   
(2). `plot_figure_save_results.py`: calculates the MSE and BER and saves them in a `.npz` file along with pyplots in the `/outputs` folder. Make sure the n_per_sinr matches the one you generated in the testset!
qpsk2_helper_fn.py
qam16_helper_fn.py
ofdm_helper_fn.py


